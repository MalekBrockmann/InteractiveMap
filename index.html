<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktive Europa-Karte mit Nachrichten</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <style>
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .logo-svg {
            width: 48px;
            height: 48px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo-container">
                <svg class="logo-svg" viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="90" cy="90" r="80" fill="#F7F2E7"/>
                    <path d="M60,60 Q70,40 90,40 Q110,40 120,60 Q130,80 110,100 Q100,110 90,120 Q80,110 70,100 Q50,80 60,60Z" fill="#2D2926"/>
                    <rect x="80" y="65" width="12" height="50" rx="6" fill="#F7F2E7"/>
                    <rect x="100" y="65" width="12" height="50" rx="6" fill="#F7F2E7"/>
                </svg>
                <div class="nav-title">Global Event Tracker</div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <section class="hero-section">
            <h1 class="hero-title">Global Event Tracker</h1>
            <p class="hero-subtitle">Interaktive Karte mit aktuellen Nachrichten aus europÃ¤ischen LÃ¤ndern</p>
        </section>

        <section class="info-section">
            <div class="info-content">
                <h2>Willkommen bei Europa Interaktiv</h2>
                <p>Entdecken Sie die Vielfalt Europas durch unsere interaktive Plattform. Wir verbinden Geografie mit aktuellen Nachrichten, um Ihnen einen einzigartigen Einblick in die europÃ¤ischen LÃ¤nder zu bieten.</p>
                
                <div class="info-features">
                    <div class="feature">
                        <h3>Interaktive Karte</h3>
                        <p>Klicken Sie auf ein Land in der Karte oder wÃ¤hlen Sie es aus dem Dropdown-MenÃ¼ aus, um mehr zu erfahren.</p>
                    </div>
                    <div class="feature">
                        <h3>Aktuelle Nachrichten</h3>
                        <p>Erhalten Sie die wichtigsten Nachrichten aus dem ausgewÃ¤hlten Land, fokussiert auf Politik, Kultur und Gesellschaft.</p>
                    </div>
                    <div class="feature">
                        <h3>Einfache Navigation</h3>
                        <p>Die intuitive BenutzeroberflÃ¤che ermÃ¶glicht es Ihnen, mÃ¼helos zwischen verschiedenen LÃ¤ndern zu wechseln und Informationen zu entdecken.</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="country-selector">
            <select id="countrySelect">
                <option value="">Land auswÃ¤hlen</option>
                <option value="de">ðŸ‡©ðŸ‡ª Deutschland</option>
                <option value="gb">ðŸ‡¬ðŸ‡§ Vereinigtes KÃ¶nigreich</option>
                <option value="fr">ðŸ‡«ðŸ‡· Frankreich</option>
                <option value="es">ðŸ‡ªðŸ‡¸ Spanien</option>
                <option value="it">ðŸ‡®ðŸ‡¹ Italien</option>
                <option value="nl">ðŸ‡³ðŸ‡± Niederlande</option>
                <option value="pt">ðŸ‡µðŸ‡¹ Portugal</option>
                <option value="se">ðŸ‡¸ðŸ‡ª Schweden</option>
                <option value="no">ðŸ‡³ðŸ‡´ Norwegen</option>
                <option value="dk">ðŸ‡©ðŸ‡° DÃ¤nemark</option>
                <option value="fi">ðŸ‡«ðŸ‡® Finnland</option>
                <option value="pl">ðŸ‡µðŸ‡± Polen</option>
                <option value="cz">ðŸ‡¨ðŸ‡¿ Tschechische Republik</option>
                <option value="sk">ðŸ‡¸ðŸ‡° Slowakei</option>
                <option value="hu">ðŸ‡­ðŸ‡º Ungarn</option>
                <option value="ro">ðŸ‡·ðŸ‡´ RumÃ¤nien</option>
                <option value="bg">ðŸ‡§ðŸ‡¬ Bulgarien</option>
                <option value="gr">ðŸ‡¬ðŸ‡· Griechenland</option>
            </select>
        </div>

        <div class="content-container">
            <h2 id="news-heading">Top-Nachrichten</h2>
            <div id="news-container" class="news-container">
                <!-- News will be loaded here -->
            </div>
        </div>
    </main>

    <footer>
        <p>Â© 2024 Europa Interaktiv. Alle Rechte vorbehalten.</p>
    </footer>

    <script>
        // Initialize the map with Europe-focused view
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: false,
            maxBounds: [[-90, -180], [90, 180]],
            maxBoundsViscosity: 1.0
        }).setView([54.5260, 15.2551], 4);

        // Add minimal tile layer (white background)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            maxZoom: 19,
            minZoom: 3
        }).addTo(map);

        let currentSelectedLayer = null;
        let geoJsonLayer = null;

        // Category keywords for news filtering
        const categoryKeywords = {
            politics: [
                'politik', 'regierung', 'wahl', 'parlament', 'minister', 'partei', 'abgeordnete',
                'politician', 'election', 'parliament', 'government', 'minister', 'party', 'vote',
                'politique', 'gouvernement', 'Ã©lection', 'parlement', 'ministre', 'parti',
                'polÃ­tica', 'gobierno', 'elecciÃ³n', 'parlamento', 'ministro', 'partido'
            ],
            culture: [
                'kultur', 'kunst', 'museum', 'theater', 'ausstellung', 'festival', 'musik',
                'culture', 'art', 'museum', 'theatre', 'exhibition', 'festival', 'music',
                'culture', 'art', 'musÃ©e', 'thÃ©Ã¢tre', 'exposition', 'festival', 'musique',
                'cultura', 'arte', 'museo', 'teatro', 'exposiciÃ³n', 'festival', 'mÃºsica'
            ],
            society: [
                'gesellschaft', 'sozial', 'bildung', 'gesundheit', 'umwelt', 'arbeit',
                'society', 'social', 'education', 'health', 'environment', 'work',
                'sociÃ©tÃ©', 'social', 'Ã©ducation', 'santÃ©', 'environnement', 'travail',
                'sociedad', 'social', 'educaciÃ³n', 'salud', 'medio ambiente', 'trabajo'
            ]
        };

        // Function to categorize an article
        function categorizeArticle(article) {
            const text = (article.title + ' ' + article.description).toLowerCase();
            const categories = {
                politics: 0,
                culture: 0,
                society: 0
            };

            // Count keyword matches for each category
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                categories[category] = keywords.reduce((count, keyword) => {
                    return count + (text.includes(keyword) ? 1 : 0);
                }, 0);
            }

            // Get the category with the highest score
            const maxCategory = Object.entries(categories).reduce((max, [category, score]) => {
                return score > max.score ? { category, score } : max;
            }, { category: null, score: 0 });

            // Only return a category if it has at least one match
            return maxCategory.score > 0 ? maxCategory.category : null;
        }

        // Function to translate text to German
        async function translateToGerman(text) {
            try {
                const response = await fetch('https://translation.googleapis.com/language/translate/v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        q: text,
                        target: 'de',
                        key: 'YOUR_GOOGLE_TRANSLATE_API_KEY' // Sie mÃ¼ssen hier Ihren API-Key einfÃ¼gen
                    })
                });
                
                const data = await response.json();
                return data.data.translations[0].translatedText;
            } catch (error) {
                console.error('Translation error:', error);
                return text; // Bei Fehler den Originaltext zurÃ¼ckgeben
            }
        }

        // Function to fetch news for a country
        async function fetchCountryNews(countryCode) {
            try {
                const response = await fetch(`https://gnews.io/api/v4/top-headlines?country=${countryCode}&max=10&token=176f485dd5326389cf33e90e1d58c60c`);
                const data = await response.json();
                
                if (data.articles && data.articles.length > 0) {
                    // Filter and categorize articles
                    const categorizedArticles = data.articles
                        .map(article => ({
                            ...article,
                            category: categorizeArticle(article)
                        }))
                        .filter(article => article.category !== null);

                    // Translate non-German articles
                    const translatedArticles = await Promise.all(
                        categorizedArticles.map(async (article) => {
                            // Nur Ã¼bersetzen, wenn es nicht bereits Deutsch ist
                            if (article.language !== 'de') {
                                const translatedTitle = await translateToGerman(article.title);
                                const translatedDescription = await translateToGerman(article.description);
                                return {
                                    ...article,
                                    title: translatedTitle,
                                    description: translatedDescription,
                                    originalTitle: article.title, // Original fÃ¼r Referenz
                                    originalDescription: article.description
                                };
                            }
                            return article;
                        })
                    );

                    return translatedArticles.slice(0, 5); // Get top 5 categorized articles
                }
                return [];
            } catch (error) {
                console.error('Error fetching news:', error);
                return null;
            }
        }

        // Function to update news display
        async function updateNews(countryCode) {
            const newsContainer = document.getElementById('news-container');
            newsContainer.innerHTML = '<div class="news-link">Lade und Ã¼bersetze Nachrichten...</div>';

            const articles = await fetchCountryNews(countryCode);
            
            if (!articles) {
                newsContainer.innerHTML = '<div class="news-link">Nachrichten konnten nicht geladen werden</div>';
                return;
            }

            if (articles.length === 0) {
                newsContainer.innerHTML = '<div class="news-link">Keine passenden Nachrichten verfÃ¼gbar</div>';
                return;
            }

            newsContainer.innerHTML = articles.map(article => `
                <a href="${article.url}" target="_blank" class="news-link">
                    <span class="news-category">${article.category}</span>
                    ${article.title} (Quelle: ${article.source.name})
                    ${article.originalTitle ? `<span class="original-text">Original: ${article.originalTitle}</span>` : ''}
                </a>
            `).join('');
        }

        // Mapping table for country names to codes
        const countryCodeMapping = {
            'Germany': 'de',
            'Deutschland': 'de',
            'United Kingdom': 'gb',
            'Great Britain': 'gb',
            'UK': 'gb',
            'France': 'fr',
            'Spain': 'es',
            'Italy': 'it',
            'Netherlands': 'nl',
            'Holland': 'nl',
            'Portugal': 'pt',
            'Sweden': 'se',
            'Norway': 'no',
            'Denmark': 'dk',
            'Finland': 'fi',
            'Poland': 'pl',
            'Czech Republic': 'cz',
            'Czechia': 'cz',
            'Czech': 'cz',
            'Slovakia': 'sk',
            'Hungary': 'hu',
            'Romania': 'ro',
            'Bulgaria': 'bg',
            'Greece': 'gr'
        };

        // Function to handle country selection
        function handleCountrySelection(countryCode) {
            if (!countryCode) return;

            // Update news heading
            const countryNames = {
                'de': 'Deutschland',
                'gb': 'Vereinigtes KÃ¶nigreich',
                'fr': 'Frankreich',
                'es': 'Spanien',
                'it': 'Italien',
                'nl': 'Niederlande',
                'pt': 'Portugal',
                'se': 'Schweden',
                'no': 'Norwegen',
                'dk': 'DÃ¤nemark',
                'fi': 'Finnland',
                'pl': 'Polen',
                'cz': 'Tschechien',
                'sk': 'Slowakei',
                'hu': 'Ungarn',
                'ro': 'RumÃ¤nien',
                'bg': 'Bulgarien',
                'gr': 'Griechenland'
            };

            const countryName = countryNames[countryCode] || 'Top-Nachrichten';
            document.getElementById('news-heading').textContent = `Top-Nachrichten aus ${countryName}`;

            // Update news
            updateNews(countryCode);
        }

        // Load GeoJSON data for Europe
        fetch('https://raw.githubusercontent.com/leakyMirror/map-of-europe/master/GeoJSON/europe.geojson')
            .then(response => response.json())
            .then(data => {
                console.log('GeoJSON data loaded:', data);
                
                // Create a new GeoJSON layer with custom styling
                geoJsonLayer = L.geoJSON(data, {
                    style: {
                        color: '#999999',
                        weight: 0.5,
                        fillOpacity: 0,
                        opacity: 0.7
                    },
                    onEachFeature: function(feature, layer) {
                        console.log('Feature properties:', feature.properties);
                        
                        // Store the country code in the layer for easy access
                        const countryCode = feature.properties.ISO2?.toLowerCase();
                        layer.countryCode = countryCode;
                        
                        // Add click handler
                        layer.on('click', function(e) {
                            console.log('Map click detected on:', feature.properties.NAME);
                            
                            // Get country code from ISO code
                            const countryCode = feature.properties.ISO2?.toLowerCase();
                            
                            console.log('Country code determined:', countryCode);
                            
                            if (!countryCode) {
                                console.warn('Kein gÃ¼ltiger countryCode gefunden fÃ¼r:', feature.properties.NAME);
                                return;
                            }

                            // Update dropdown selection programmatically
                            const selectElement = document.getElementById('countrySelect');
                            selectElement.value = countryCode;

                            // Highlight the selected country
                            if (currentSelectedLayer) {
                                currentSelectedLayer.setStyle({
                                    fillOpacity: 0,
                                    fillColor: '#999999'
                                });
                            }
                            layer.setStyle({
                                fillOpacity: 0.3,
                                fillColor: '#666666'
                            });
                            currentSelectedLayer = layer;

                            // Trigger the same function as selecting the country in the dropdown
                            handleCountrySelection(countryCode);
                        });

                        // Add hover effects
                        layer.on('mouseover', function() {
                            if (layer !== currentSelectedLayer) {
                                layer.setStyle({
                                    fillOpacity: 0.3,
                                    fillColor: '#666666'
                                });
                            }
                        });

                        layer.on('mouseout', function() {
                            if (layer !== currentSelectedLayer) {
                                layer.setStyle({
                                    fillOpacity: 0,
                                    fillColor: '#999999'
                                });
                            }
                        });
                    }
                }).addTo(map);

                // Add click handler to the map to reset selection when clicking outside countries
                map.on('click', function() {
                    // Reset all layers
                    geoJsonLayer.eachLayer(function(layer) {
                        layer.setStyle({
                            fillOpacity: 0,
                            fillColor: '#999999'
                        });
                    });
                    
                    // Reset dropdown
                    document.getElementById('countrySelect').value = '';
                    
                    // Reset news heading
                    document.getElementById('news-heading').textContent = 'Top-Nachrichten';
                    
                    // Clear news container
                    document.getElementById('news-container').innerHTML = '';
                    
                    // Clear current selection
                    currentSelectedLayer = null;
                });

                // Debug: Log all features
                console.log('Loaded features:', data.features.map(f => ({
                    name: f.properties.NAME,
                    iso2: f.properties.ISO2
                })));
            })
            .catch(error => console.error('Error loading GeoJSON:', error));

        // Add event listener for country selection in dropdown
        document.getElementById('countrySelect').addEventListener('change', function(e) {
            console.log('Dropdown changed to:', e.target.value);
            handleCountrySelection(e.target.value);
        });
    </script>
</body>
</html> 